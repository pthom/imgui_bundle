<!doctype html>
<html>
<head>
    <title>imgui-bundle Pyodide Test</title>
    <style>
        html, body { width: 100%; height: 100%; margin: 0; }
        #canvas { display: block; width: 100%; height: 100%; }
    </style>
    <!-- Load Pyodide from local dist -->
    <script src="output/pyodide_dist/pyodide.js"></script>
    <!-- Or from CDN: -->
    <!--     <script src="https://cdn.jsdelivr.net/pyodide/v0.28.2/full/pyodide.js"></script>-->
</head>
<body>
<canvas id="canvas" tabindex="0"></canvas>

<script type="text/javascript">

// ====================== Start of Python code ============================
const pythonCode = `
from imgui_bundle import imgui, hello_imgui, immapp

def top_panel_gui():
    imgui.text("Top Panel Content")
    imgui.separator()
    if imgui.button("Top Button"):
        print("Top button clicked!")

def bottom_panel_gui():
    imgui.text("Bottom Panel Content")
    imgui.separator()
    if imgui.button("Bottom Button"):
        print("Bottom button clicked!")

async def main():
    # Create runner parameters
    runner_params = hello_imgui.RunnerParams()

    # Enable full screen dock space
    runner_params.imgui_window_params.default_imgui_window_type = (
        hello_imgui.DefaultImGuiWindowType.provide_full_screen_dock_space
    )

    # Set window size
    runner_params.app_window_params.window_geometry.size = (800, 600)

    # Create docking split: split MainDockSpace into top and bottom
    runner_params.docking_params.docking_splits = [
        hello_imgui.DockingSplit(
            initial_dock_="MainDockSpace",
            new_dock_="BottomSpace",
            direction_=imgui.Dir.down,
            ratio_=0.5  # 50% split
        )
    ]

    # Create dockable windows
    runner_params.docking_params.dockable_windows = [
        hello_imgui.DockableWindow(
            label_="Top Panel",
            dock_space_name_="MainDockSpace",
            gui_function_=top_panel_gui
        ),
        hello_imgui.DockableWindow(
            label_="Bottom Panel",
            dock_space_name_="BottomSpace",
            gui_function_=bottom_panel_gui
        )
    ]

    runner_params.imgui_window_params.show_menu_bar = True

    # Run the application
    await immapp.run_async(runner_params)
    print("Application has exited.")


import asyncio
asyncio.create_task(main())
`;
// ====================== End of Python code ==============================


async function main() {
    try {
        // Enable right-click in canvas
        document.addEventListener('contextmenu', event => event.preventDefault());

        // Load Pyodide with local packages
        let pyodide = await loadPyodide();

        // Setup SDL canvas
        // See: https://pyodide.org/en/stable/usage/sdl.html
        let sdl2Canvas = document.getElementById("canvas");
        pyodide.canvas.setCanvas2D(sdl2Canvas);

        // SDL requires this opt-in flag
        pyodide._api._skip_unwind_fatal_error = true;

        // Load imgui-bundle package
        // Option 1: Load from local wheel (built package)
        await pyodide.loadPackage("imgui_bundle");

        // Option 2: Load from URL
        // await pyodide.loadPackage("./imgui_bundle-1.92.6-cp313-cp313-pyodide_2025_0_wasm32.whl");

        // Option 3: Use micropip for packages from PyPI (when available)
        // await pyodide.loadPackage("micropip");
        // const micropip = pyodide.pyimport("micropip");
        // await micropip.install('imgui-bundle');


        // Run the Python code
        pyodide.runPython(pythonCode);

    } catch (error) {
        console.error("Failed to load:", error);
    }
}

main();
</script>
</body>
</html>
